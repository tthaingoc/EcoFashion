Update Todos
  â¿ Â â˜’ Create OrderPaymentService with PayWithWallet method             
     â˜’ Create SettlementService with CreateSettlementsForOrder method
     â˜’ Add ReleasePayoutsForOrder method to SettlementService
     â˜’ Create checkout controller endpoints for wallet payments
     â˜’ Add settlements controller for payout release
     â˜’ Update existing payment callback to integrate settlement creation
     â˜’ Add admin wallet configuration

â— ÄÃ£ hoÃ n thÃ nh táº¥t cáº£ cÃ¡c thÃ nh pháº§n cáº§n thiáº¿t cho há»‡ thá»‘ng thanh toÃ¡n vÃ­ + chia tiá»n Ä‘a seller theo yÃªu cáº§u cá»§a báº¡n:

  âœ… ÄÃ£ Implementation

  1. OrderPaymentService - Thanh toÃ¡n qua vÃ­:
  - PayWithWalletAsync(): Thanh toÃ¡n Ä‘Æ¡n láº» qua vÃ­
  - PayGroupWithWalletAsync(): Thanh toÃ¡n nhÃ³m Ä‘Æ¡n qua vÃ­

  2. SettlementService - Quáº£n lÃ½ chia tiá»n:
  - CreateSettlementsForOrderAsync(): Táº¡o settlement theo tá»«ng seller
  - ReleasePayoutsForOrderAsync(): Chi tráº£ 90% cho seller, giá»¯ 10% admin
  - ReleasePayoutsForGroupAsync(): Chi tráº£ cho nhÃ³m Ä‘Æ¡n

  3. Controller Endpoints:
  - POST /api/checkout/pay-with-wallet: Thanh toÃ¡n Ä‘Æ¡n qua vÃ­
  - POST /api/checkout/pay-group-with-wallet: Thanh toÃ¡n nhÃ³m Ä‘Æ¡n
  - POST /api/settlements/release: Admin chi tráº£ (cÃ³ auth)
  - POST /api/settlements/demo-complete-order: Demo hoÃ n thÃ nh Ä‘Æ¡n

  4. TÃ­ch há»£p PaymentService:
  - VNPay callback tá»± Ä‘á»™ng táº¡o settlement + chi tráº£
  - Demo shipment: sau paid â†’ delivered â†’ chia tiá»n

  5. Configuration:
  - AdminUserId: 1, CommissionRate: 10% trong appsettings.json
  - Service registration trong DI container

  6. WalletService má»Ÿ rá»™ng:
  - GetWalletByUserIdAsync(): Láº¥y/táº¡o vÃ­ user
  - CreateTransactionAsync(): Ghi giao dá»‹ch vá»›i OrderId/SettlementId

  ğŸ”„ Luá»“ng hoáº¡t Ä‘á»™ng

  Thanh toÃ¡n vÃ­:
  1. Customer gá»i /pay-with-wallet â†’ trá»« vÃ­ customer, cá»™ng vÃ­ admin
  2. Táº¡o OrderSellerSettlement (Pending) theo tá»«ng seller
  3. Demo: tá»± Ä‘á»™ng delivered + release payout ngay

  Thanh toÃ¡n VNPay (hiá»‡n táº¡i):
  1. VNPay callback success â†’ táº¡o settlement â†’ release payout â†’ delivered

  Chia tiá»n:
  - Admin giá»¯ 10% commission
  - 90% chuyá»ƒn cho seller (supplier/designer) khi delivered

  Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ test cáº£ 2 cÃ¡ch thanh toÃ¡n vÃ  chia tiá»n theo Ä‘Ãºng yÃªu cáº§u cá»§a báº¡n!

--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------

Features Added (already done)

  1. Address Integration in Checkout:
  - Modified create-session-from-cart to accept AddressId parameter
  - Auto-loads default address if no address is specified
  - Uses formatted address string from UserAddress entity

  2. Address Management During Checkout:
  - GET /api/checkout/addresses - Get user's saved addresses
  - POST /api/checkout/create-address - Create new address during checkout
  - PUT /api/checkout/update-address/{addressId} - Update existing address

  3. Order Address Updates:
  - PUT /api/checkout/order/{orderId}/address - Update single order address
  - PUT /api/checkout/order-group/{orderGroupId}/address - Update order group address
  - Support both AddressId (saved address) and direct ShippingAddress string

  4. Service Layer Enhancements:
  - Added UserAddressService dependency to CheckoutService
  - UpdateOrderAddressAsync() - Update order with saved address
  - UpdateOrderGroupAddressAsync() - Update multiple orders in group
  - UpdateOrderAddressDirectAsync() - Update with custom address string

  ğŸ”„ Usage Flow

  1. Checkout with Saved Address:
  POST /api/checkout/create-session-from-cart
  {
    "addressId": 123
  }

  2. Checkout with Custom Address:
  POST /api/checkout/create-session-from-cart
  {
    "shippingAddress": "123 Custom Street, District, City"
  }

  3. Create New Address During Checkout:
  POST /api/checkout/create-address
  {
    "addressLine": "123 New Street",
    "district": "District 1",
    "city": "Ho Chi Minh City",
    "isDefault": false
  }

  4. Update Order Address:
  PUT /api/checkout/order/{orderId}/address
  {
    "addressId": 456
  }

  The system now fully supports address management during checkout, allowing users to:
  - Use their saved addresses
  - Create new addresses on-the-fly
  - Update order addresses before payment
  - Manage default addresses
  - Format addresses consistently for display

  All address changes are only allowed for orders with PaymentStatus.Pending to prevent modification of paid orders.

--------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------
Gá»£i Ã½ cáº£i thiá»‡n FE cho vÃ­ (ngáº¯n gá»n, Ã¡p dá»¥ng dáº§n)
TanStack Query (react-query): quáº£n lÃ½ data wallet/summary, transactions, vÃ  mutation náº¡p/rÃºt; cache + tá»± Ä‘á»™ng refetch sau callback VNPay.
Cache keys: ['wallet','summary'], ['wallet','transactions', page, pageSize]
Sau khi náº¡p thÃ nh cÃ´ng: queryClient.invalidateQueries({queryKey:['wallet']})
Custom hooks: gom API + query/mutation, UI gá»i hook, code gá»n vÃ  dá»… test.
useWalletSummary(), useWalletTransactions(p, s), useInitiateDeposit(), useRequestWithdraw()
Zod + react-hook-form: validate form náº¡p/rÃºt (sá»‘ tiá»n min/max, bá»™i sá»‘, mÃ´ táº£).
Hiá»‡n báº¡n Ä‘ang validate thá»§ cÃ´ng; dÃ¹ng schema -> lá»—i hiá»ƒn thá»‹ nháº¥t quÃ¡n, Ã­t bug.
UI/UX:
Loading skeletons cho pháº§n sá»‘ dÆ° vÃ  lá»‹ch sá»­.
Cháº·n double-submit (disable nÃºt, pending state).
Toast cho lá»—i API (dá»±a vÃ o interceptor Ä‘Ã£ cÃ³).
â€œXem táº¥t cáº£ giao dá»‹châ€ â†’ trang riÃªng cÃ³ phÃ¢n trang vÃ´ háº¡n (infinite query) hoáº·c pagination.
Äá»“ng bá»™ callback VNPay:
á» WalletPage, sau khi detect vnp_*, gá»i queryClient.invalidateQueries(['wallet']) Ä‘á»ƒ cáº­p nháº­t sá»‘ dÆ°/tÃ³m táº¯t.
KhÃ´ng cáº§n call backend callback ná»¯a vÃ¬ VNPay Ä‘Ã£ gá»i, chá»‰ cáº§n refetch.
Type safety:
TÃ¡ch types FE vÃ o types/wallet.ts Ä‘á»ƒ tÃ¡i dá»¥ng; trÃ¡nh láº«n vá»›i payload.
Khi nÃ o nÃªn lÃ m ngay
Ãp dá»¥ng react-query + hooks cho wallet/summary vÃ  deposit mutation (tÃ¡c Ä‘á»™ng UX lá»›n nháº¥t).
DÃ¹ng zod + RHF cho form náº¡p (trÃ¡nh lá»—i 500 do payload khÃ´ng há»£p lá»‡).
Bá»• sung skeletons/loading vÃ  cháº·n double-click.
Khi cáº§n thÃªm
Trang â€œTáº¥t cáº£ giao dá»‹châ€ + infinite query.
Unit test cho hooks (mock axios).
